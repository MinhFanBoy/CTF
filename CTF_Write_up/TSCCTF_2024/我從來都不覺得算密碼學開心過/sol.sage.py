

# This file was *autogenerated* from the file sol.sage
from sage.all_cmdline import *   # import sage library

_sage_const_42899 = Integer(42899); _sage_const_1934 = Integer(1934); _sage_const_22627 = Integer(22627); _sage_const_36616 = Integer(36616); _sage_const_21343 = Integer(21343); _sage_const_4 = Integer(4); _sage_const_5 = Integer(5); _sage_const_1 = Integer(1); _sage_const_0 = Integer(0); _sage_const_2 = Integer(2); _sage_const_16 = Integer(16)
from Crypto.Util.number import getPrime, long_to_bytes
from Crypto.Util.Padding import pad
from Crypto.Cipher import AES
from tqdm import *

# load("https://raw.githubusercontent.com/MinhFanBoy/CTF/refs/heads/main/Important/solve_linear_mod.sage")
p = _sage_const_42899 
hs = [_sage_const_1934 , _sage_const_22627 , _sage_const_36616 , _sage_const_21343 ]
ciphertext = b'z\xa5\xa5\x1d\xe5\xd2I\xb1\x15\xec\x95\x8b^\xb6:r=\xe3h\x06-\xe9\x01\xda\xc03\xa4\xf6\xa8_\x8c\x12!MZP\x17O\xee\xa3\x0f\x05\x0b\xea7cnP'
flag = b"TSC{"
def check(r):
    re = []
    for i in range(_sage_const_4 ):
        h = flag[i]
        for j in range(_sage_const_5 ):
            h = (h + (j+_sage_const_1 ) * r[j]) % p
            r[j] = h
        re.append(h)
    return re
# rs = [var(f"r_{i}") for i in range(5)]

F = PolynomialRing(GF(p), ['r0', 'r1', 'r2', 'r3', 'r4'])
rs = F.gens()
r = list(rs)
M = []
N = []
for i in range(_sage_const_4 ):
    h = flag[i]
    for j in range(_sage_const_5 ):
        h = (h + (j+_sage_const_1 ) * r[j])
        r[j] = h
    M.append((h - hs[i]).coefficients()[:-_sage_const_1 ])
    N.append(-(h - hs[i]).coefficients()[-_sage_const_1 ])

M = matrix(M)
N = vector(N)

r = M.solve_right(N)
tmp = M.right_kernel_matrix()

for i in trange(p):
    _r = vector(GF(p), vector(r) + i * vector(tmp))
    _r = list(map(int, list(_r)))

    for i in range(_sage_const_4 ):
        h = flag[i]
        for j in range(_sage_const_5 ):
            h = (h + (j+_sage_const_1 ) * _r[j]) % p
            _r[j] = h
    _r = list(map(int, _r))
    key = _sage_const_0 
    for rr in _r:
        key += rr
        key *= _sage_const_2 **_sage_const_16 
    key = int(key)
    key = pad(long_to_bytes(key), _sage_const_16 )
    aes = AES.new(key, AES.MODE_ECB)
    
    txt = aes.decrypt(ciphertext)
    if b"TSC{" in txt:
        print(txt)
        break

