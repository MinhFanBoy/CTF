from Crypto.Util.number import *
from random import getrandbits

FLAG = b'KCSC{fake_flag}'

p = getrandbits(1024)
q = getrandbits(1024)

def encrypt(msg, key):
    m = bytes_to_long(msg)
    return p * m + q * (m**3 + m**2 + m) + (3*m + 2*p + q) * key

# pm +q(m^3 + m^2 + m) + (3m + 2p + q)*k = c
# mod q cho 2 ve
# pm + (3m + 2p)*k = c (mod q )
# k = (c - pm)/(3m + 2p) (mod q)

# vi co 2 m =>
# (c_1 - pm_1)/(3m_1 + 2p) = (c_2 - pm_2)/(3m_2 + 2p) (mod q)
# (c_1 - pm_1)*(3m_2 + 2p) = (c_2 - pm_2)*(3m_1 + 2p) (mod p)
# c_1 3m_2 + c_1 2p -pm_1 3m_2 - pm_1 2p = c_2 3m_1 + c_2 2p -pm_2 3m_1 - pm_2 2p (mod q)
# c_1 3m_2 - c_2 3m_1 + c_1 2p - c_2 2p - pm_1 2p + pm_2 2p = 0 (mod q)
# m_1(-3c_2 - 2 pp) + m_2(3c_1 + 2pp) + c_1 2p - c_2 2p = 0 (mod q )
# m_1(-3c_2 - 2 pp) + m_2(3c_1 + 2pp) + p(c_1 2 - c_2 2) = kq

# [(-3c_2 - 2 pp) 1 0 0]
# [(3c_1 + 2pp)   0 1 0] 
# [(2c_1 - 2c_2)] 0 0 1]
# [q              0 0 0]

```python
n = 30
p = 48762188199150535581975412897924691165761153794040728191647919999953750500528915467941977942434049609148928874111418540791659239318033502960490438029918494978450003766475054277305000975826296521110691624198929727387822917181466972531783670424803605073382160801015364428887438227795060240461156343151628730113
q = 123154173062875129803388789468997467602861692189899574796521281322028039797350493630230549858629977130216821188366984746616639200404382396043604419180869596904421472720201306121199119571368299417757494448400590479108311324077855468994881760593143713996410859474408904326793393402741912427742694768217550181270
c1 = 21361708399259692476490585224474478239848096267728875151027667930547884138531321455258045949871008481309353774592024104870537486086028259415199204699193912434732702436520694573344765029331922878031532757006467986508373826559848018510846704694596043438688980012743479503379279444261834245820139438602646123909719216866856864573656625922211883930084371564748739048999645791127706355352400765930549436631488077615035313501456035704196655631076251694505647371287090426267130518184310327417676973790605083858188079554372289805772049887809199182600395727164328773350053287895190505219555434017220365550650906129322383481252
c2 = 21361708399259692476490585224474478239848096267728875151027667930547884138531321455258045949871008481309353774592024104870537486086028259415199204699193912434732702462872923491616113323696576471401453366769073405539609186296897006352387813496579755357765019379630756911340195523429031527586036900468063337747524187687027790122248988574172180712302674206934331239449040784296700054535172565955515658035497532654412975186522396759714280936589419263016914222837327779108969285650803460583010919600081536939185789237255320735405198555005684445856588326590949453146466337908623498742769971401502687499945846050861617865180
L = matrix([[(3*c1 + 2*p*p)*(2**1024), 1, 0, 0],[(3*c2 + 2*p*p)*(2**1024), 0, 1, 0],[p * (2*c1 - 2*c2)*(2**1024), 0, 0, 2**1024],[q*(2**1024), 0, 0, 0]])
print(L.LLL())
```


n = 30
p = 48762188199150535581975412897924691165761153794040728191647919999953750500528915467941977942434049609148928874111418540791659239318033502960490438029918494978450003766475054277305000975826296521110691624198929727387822917181466972531783670424803605073382160801015364428887438227795060240461156343151628730113
q = 123154173062875129803388789468997467602861692189899574796521281322028039797350493630230549858629977130216821188366984746616639200404382396043604419180869596904421472720201306121199119571368299417757494448400590479108311324077855468994881760593143713996410859474408904326793393402741912427742694768217550181270
c1 = 21361708399259692476490585224474478239848096267728875151027667930547884138531321455258045949871008481309353774592024104870537486086028259415199204699193912434732702436520694573344765029331922878031532757006467986508373826559848018510846704694596043438688980012743479503379279444261834245820139438602646123909719216866856864573656625922211883930084371564748739048999645791127706355352400765930549436631488077615035313501456035704196655631076251694505647371287090426267130518184310327417676973790605083858188079554372289805772049887809199182600395727164328773350053287895190505219555434017220365550650906129322383481252
c2 = 21361708399259692476490585224474478239848096267728875151027667930547884138531321455258045949871008481309353774592024104870537486086028259415199204699193912434732702462872923491616113323696576471401453366769073405539609186296897006352387813496579755357765019379630756911340195523429031527586036900468063337747524187687027790122248988574172180712302674206934331239449040784296700054535172565955515658035497532654412975186522396759714280936589419263016914222837327779108969285650803460583010919600081536939185789237255320735405198555005684445856588326590949453146466337908623498742769971401502687499945846050861617865180


L = [[                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                            -2233024689706311826935057754702074456177790414515113016677475447421086091291214057438340581355397257866186769103826316290704904902834231861942159803956777,                                                                                                                                                             2173631958668871688305502032180746450455597467926921254712660961597431995038245206149139150530172342115133148635831919638089092137068638647127761805840581,                                                                                                                                                                                                                                                                                                                      0,],
[                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                           -13610170635183146180565626058442018412871770488026919171441809309383140411524702705621505533135397973233262501539360690555081477543943913652884174436584246,                                                                                                                                                           -14327465712022498326861259611307725672933946001870823134430698176854727426585813324045035204181515627635487888940439994280574728417095504880503563850550517,                                                                                                                                                                                                                                                                                                                      0,],
[                                                                                                                                                                                                                                                                                                                     0,                                                                                                                                                                                                                                                                       664415457209781694288264696393686878037291584637,                                                                                                                                                                                                                                                                      -429675711022751492886702095556098737230277718905,  179769313486231590772930519078902473361797697894230657273430081157732675805500963132708477322407536021120113879871393357658789768814416622492847430639474124377767893424865485276302219601246094119453082952085005768838150682342462881473913110540827237163350510684586298239947245938479716304835356329624224137216,],
[-359538626972463181545861038157804946723595395788461314546860162315465351611001926265416954644815072042240227759742786715317579537628833244985694861278948248755535786849730970552604439202492188238906165904170011537676301364684925762947826221081654474326701021369172596479894491876959432609670712659248448274432,                                                                                                                                                            -1858659868232869892542039265934158806428247582585712495797062041341666028576588050474726284884349928241954873686505123620269754217405457057751733008505785,                                                                                                                                                             -116392986971810987785296183429093710677571415091315765499790937055371891572996429234087431890079556402517604913932744658336906725876182430287057998256984,                                                                                                                                                                                                                                                                                                                      0]]
m1 = long_to_bytes(429675711022751492886702095556098737230277718905).decode()
m2 = long_to_bytes(664415457209781694288264696393686878037291584637).decode()
print(m1 + m2[10:])
